<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>W4M Galaxy Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/w4m.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta name="twitter:title" content="W4M Galaxy Documentation">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/w4m.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">W4M Galaxy Documentation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-galaxy-w4m" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-boxes" role="img">
</i> 
 <span class="menu-text">Galaxy W4M</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-galaxy-w4m">    
        <li>
    <a class="dropdown-item" href="./galaxyW4M.html"><i class="bi bi-info-circle" role="img">
</i> 
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./tooluser.html"><i class="bi bi-code" role="img">
</i> 
 <span class="dropdown-text">Guides for Users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./tooldev.html"><i class="bi bi-code" role="img">
</i> 
 <span class="dropdown-text">Guides for Developpers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./contribute.html"><i class="bi bi-person-fill-up" role="img">
</i> 
 <span class="dropdown-text">How to contribute</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tools" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-tools" role="img">
</i> 
 <span class="menu-text">Tools</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tools">    
        <li>
    <a class="dropdown-item" href="./tool1.html">
 <span class="dropdown-text">Tool 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./tool2.html">
 <span class="dropdown-text">Tool 2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./news.html"> <i class="bi bi-calendar-week" role="img">
</i> 
<span class="menu-text">News &amp; Events</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./listing_team.html"> <i class="bi bi-people" role="img">
</i> 
<span class="menu-text">W4M Team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://twitter.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/workflow4metabolomics/workflow4metabolomics">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/workflow4metabolomics/workflow4metabolomics/issues">
            Report a Bug
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/workflow4metabolomics/workflow4metabolomics//Workflow4Metabolomics%20Galaxy%20Documentation#readme">
            Contribute
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#workflow4metabolomics-guidelines" id="toc-workflow4metabolomics-guidelines" class="nav-link active" data-scroll-target="#workflow4metabolomics-guidelines">Workflow4Metabolomics Guidelines</a>
  <ul class="collapse">
  <li><a href="#outlines" id="toc-outlines" class="nav-link" data-scroll-target="#outlines">Outlines</a>
  <ul class="collapse">
  <li><a href="#tool-dependencies-using-conda" id="toc-tool-dependencies-using-conda" class="nav-link" data-scroll-target="#tool-dependencies-using-conda">Tool dependencies using Conda</a></li>
  <li><a href="#writing-a-tool" id="toc-writing-a-tool" class="nav-link" data-scroll-target="#writing-a-tool">Writing a tool</a></li>
  <li><a href="#writing-a-tool-using-planemo" id="toc-writing-a-tool-using-planemo" class="nav-link" data-scroll-target="#writing-a-tool-using-planemo">Writing a tool using Planemo</a></li>
  <li><a href="#testing-a-tool-using-planemo" id="toc-testing-a-tool-using-planemo" class="nav-link" data-scroll-target="#testing-a-tool-using-planemo">Testing a tool using Planemo</a></li>
  <li><a href="#using-ant-to-run-planemo" id="toc-using-ant-to-run-planemo" class="nav-link" data-scroll-target="#using-ant-to-run-planemo">Using Ant to run Planemo</a></li>
  <li><a href="#automate-testing-within-github-using-travis" id="toc-automate-testing-within-github-using-travis" class="nav-link" data-scroll-target="#automate-testing-within-github-using-travis">Automate testing within GitHub using Travis</a></li>
  <li><a href="#publish-a-tool-in-the-toolshed-using-planemo" id="toc-publish-a-tool-in-the-toolshed-using-planemo" class="nav-link" data-scroll-target="#publish-a-tool-in-the-toolshed-using-planemo">Publish a tool in the ToolShed using Planemo</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="workflow4metabolomics-guidelines" class="level1">
<h1>Workflow4Metabolomics Guidelines</h1>
<section id="outlines" class="level2">
<h2 class="anchored" data-anchor-id="outlines">Outlines</h2>
<ul>
<li><a href="#tool-dependencies-using-conda">Tool dependencies using Conda</a></li>
<li><a href="#writing-a-tool">Writing a tool</a></li>
<li><a href="#writing-a-tool-using-planemo">Writing a tool using Planemo</a></li>
<li><a href="#testing-a-tool-using-planemo">Testing a tool using Planemo</a></li>
<li><a href="#using-ant-to-run-planemo">Using Ant to run Planemo</a></li>
<li><a href="#automate-testing-within-github-using-travis">Automate testing within GitHub using Travis</a></li>
<li><a href="#publish-a-tool-in-the-toolshed-using-planemo">Publish a tool in the ToolShed using Planemo</a></li>
</ul>
<section id="tool-dependencies-using-conda" class="level3">
<h3 class="anchored" data-anchor-id="tool-dependencies-using-conda">Tool dependencies using Conda</h3>
<p>A tool may require to operate some external softwares (call dependencies) like binaries, python or R packages/libraries. <a href="http://conda.pydata.org/">Conda</a> is a package manager that among many other things can be used to manage Python packages. It became since july 2016, the default package manager within Galaxy. In Galaxy, <a href="http://conda.pydata.org/">Conda</a> will search by default in 3 channels: defaults, <a href="https://anaconda.org/r">r</a> and <a href="https://bioconda.github.io/">bioconda</a></p>
<section id="installing-conda" class="level4">
<h4 class="anchored" data-anchor-id="installing-conda">Installing Conda</h4>
<p>Galaxy currently will use miniconda2 (Python 2.7), so prefer is then miniconda3.</p>
<section id="using-a-classic-bash-script" class="level5">
<h5 class="anchored" data-anchor-id="using-a-classic-bash-script">Using a classic bash script</h5>
<p>Follow this link <a href="http://conda.pydata.org/miniconda.html">http://conda.pydata.org/miniconda.html</a></p>
</section>
<section id="using-planemo" class="level5">
<h5 class="anchored" data-anchor-id="using-planemo">Using Planemo</h5>
<ol type="1">
<li>See <a href="#installing-planemo">Installing Planemo</a></li>
<li><code>planemo conda_init --conda_prefix "/usr/conda/"</code></li>
</ol>
</section>
<section id="using-a-package-manager" class="level5">
<h5 class="anchored" data-anchor-id="using-a-package-manager">Using a Package manager</h5>
<p>For testing your recipe, you will need conda.</p>
<p>Installing miniconda on macOS:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> cask install miniconda</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The installation is done in <code>~/miniconda3</code>. The binaries are installed inside <code>~/miniconda3/bin</code>.</p>
</section>
<section id="installing-conda-build" class="level5">
<h5 class="anchored" data-anchor-id="installing-conda-build">Installing conda-build</h5>
<p>Then install <code>conda-build</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/miniconda3/bin/conda</span> install conda-build</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="developing-a-new-recipe-for-bioconda" class="level4">
<h4 class="anchored" data-anchor-id="developing-a-new-recipe-for-bioconda">Developing a new recipe for bioconda</h4>
<p>The tests may fail if the requirements cannot be found neither in conda nor in bioconda. Thus you may be forced to develop a new recipe for bioconda in order for the tests to pass.</p>
<p>To develop a new recipe, either ask to be part of Bioconda team for contributing to new recipes (repository bioconda-recipes) as explained in <a href="https://github.com/bioconda/bioconda-recipes">Bioconda recipes README</a>, or fork <a href="https://github.com/bioconda/bioconda-recipes">bioconda-recipes</a> and send a pull-request.</p>
<p>Follow the instructions in <a href="https://github.com/bioconda/bioconda-recipes">Bioconda recipes README</a>.</p>
<section id="write-your-recipe" class="level5">
<h5 class="anchored" data-anchor-id="write-your-recipe">Write your recipe</h5>
<p>To write your recipe, follow the instructions in <a href="https://github.com/bioconda/bioconda-recipes/blob/master/GUIDELINES.md">Guidelines for bioconda recipes</a>. You will find instructions for each development language.</p>
<section id="r-cran-package" class="level6">
<h6 class="anchored" data-anchor-id="r-cran-package">R CRAN package</h6>
<p>For writing a recipe for a R CRAN package, use the skeleton generator:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> recipes</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/miniconda3/bin/conda</span> skeleton cran mypkg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bioconductor-package" class="level6">
<h6 class="anchored" data-anchor-id="bioconductor-package">Bioconductor package</h6>
<p>For writing a recipe for a Bioconductor package, use the specific generator:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> scripts/bioconductor/bioconductor_skeleton.py mypkg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Python3 is required, but is not explicitly called by this script, so you need to specify it unless it is the default on your system. Make sure that you have installed the necessary packages for this script:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> install pyaml bs4 requests</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="build-your-recipe-to-test-your-package" class="level5">
<h5 class="anchored" data-anchor-id="build-your-recipe-to-test-your-package">Build your recipe to test your package</h5>
<p>To build your recipe, run:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/miniconda3/bin/conda</span> build recipes/myrecipe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If it is a R package add the option <code>--channel r</code>, and if it depends on other bioconda recipes add <code>--channel bioconda</code>.</p>
<p>See also <a href="http://conda.pydata.org/docs/building/recipe.html">Conda build recipes</a>.</p>
</section>
<section id="publish" class="level5">
<h5 class="anchored" data-anchor-id="publish">Publish</h5>
<p>Now you just have to send a pull-request and wait, Travis CI will run the tests, and merge your recipe automatically into the master branch in case of success.</p>
</section>
</section>
</section>
<section id="writing-a-tool" class="level3">
<h3 class="anchored" data-anchor-id="writing-a-tool">Writing a tool</h3>
<section id="creating-a-tool-repository" class="level4">
<h4 class="anchored" data-anchor-id="creating-a-tool-repository">Creating a tool repository</h4>
</section>
<section id="writing-the-tool-xml-file" class="level4">
<h4 class="anchored" data-anchor-id="writing-the-tool-xml-file">Writing the tool XML file</h4>
<p>As a reference, see the <a href="https://wiki.galaxyproject.org/Admin/Tools/ToolConfigSyntax">Tool XML file syntax</a> from the Galaxy project wiki. The <a href="https://galaxy-iuc-standards.readthedocs.io/en/latest/">Galaxy Intergalactic Utilities Commission Standards and Best Practices</a> are also worth reading.</p>
</section>
</section>
<section id="writing-a-tool-using-planemo" class="level3">
<h3 class="anchored" data-anchor-id="writing-a-tool-using-planemo">Writing a tool using Planemo</h3>
<section id="planemo" class="level4">
<h4 class="anchored" data-anchor-id="planemo">Planemo</h4>
<p><a href="https://github.com/galaxyproject/planemo">Planemo</a> is part of the Galaxy project, and is made for easing the development and testing of Galaxy tools. A <a href="http://planemo.readthedocs.org/en/latest/index.html">documentation</a> is available, so we will give here only the basic knowledge. A <a href="http://www.france-bioinformatique.fr/sites/default/files/gd2015-planemo-1.0_0.pdf">French course (slides)</a> given at the Galaxy Day (Nov.&nbsp;11 2015) is also available.</p>
</section>
<section id="installing-planemo" class="level4">
<h4 class="anchored" data-anchor-id="installing-planemo">Installing Planemo</h4>
<section id="using-python-pip-in-a-virtual-environment" class="level5">
<h5 class="anchored" data-anchor-id="using-python-pip-in-a-virtual-environment">Using Python pip in a virtual environment</h5>
<ul>
<li>Installing Planemo</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">virtualenv</span> ~/.planemo-venv</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span> ~/.planemo-venv/bin/activate</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install planemo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Before using Planemo on your terminal, you will need to activate your virtualenv environment:</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span> ~/.planemo-venv/bin/activate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="using-brew-for-macos" class="level5">
<h5 class="anchored" data-anchor-id="using-brew-for-macos">Using Brew for MacOS</h5>
<p>Under macOS, you can also use Homebrew for installing Planemo:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> tap galaxyproject/tap</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install planemo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="init-planemo" class="level5">
<h5 class="anchored" data-anchor-id="init-planemo">Init Planemo</h5>
<p><code>planemo init</code> will create a file in the home directory called <code>.planemo.yml</code> where you will be able to set your ToolShed credentials</p>
</section>
</section>
<section id="init-a-tool" class="level4">
<h4 class="anchored" data-anchor-id="init-a-tool">Init a tool</h4>
<p>Planemo propose to create the tool skeloton</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> tool_init</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="writing-correctly-your-tool-xml-file-for-planemo" class="level4">
<h4 class="anchored" data-anchor-id="writing-correctly-your-tool-xml-file-for-planemo">Writing correctly your tool XML file for Planemo</h4>
<section id="order-of-sections" class="level5">
<h5 class="anchored" data-anchor-id="order-of-sections">Order of sections</h5>
<p>The sections of your tool XML file, must be in the specific order:</p>
<ol type="1">
<li><code>&lt;description&gt;</code></li>
<li><code>&lt;requirements&gt;</code></li>
<li><code>&lt;command&gt;</code></li>
<li><code>&lt;inputs&gt;</code></li>
<li><code>&lt;outputs&gt;</code></li>
<li><code>&lt;tests&gt;</code></li>
<li><code>&lt;help&gt;</code></li>
<li><code>&lt;citations&gt;</code></li>
</ol>
</section>
<section id="requirements" class="level5">
<h5 class="anchored" data-anchor-id="requirements"><code>&lt;requirements&gt;</code></h5>
<p>If your script <code>mytool-script</code> is written in R, and have the following R library dependencies: <code>batch</code>, <code>PMCMR</code>, you have to define the following lines inside your tool XML file:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">requirements</span>&gt;</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">requirement</span><span class="ot"> type=</span><span class="st">"package"</span><span class="ot"> version=</span><span class="st">"3.2.2"</span>&gt;R&lt;/<span class="kw">requirement</span>&gt;</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">requirement</span><span class="ot"> type=</span><span class="st">"package"</span>&gt;r-batch&lt;/<span class="kw">requirement</span>&gt;</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">requirement</span><span class="ot"> type=</span><span class="st">"package"</span>&gt;r-pmcmr&lt;/<span class="kw">requirement</span>&gt;</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">requirements</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Requirements will be looked for inside 3 channels: default, <a href="https://anaconda.org/r">r</a>, and <a href="https://bioconda.github.io/index.html">bioconda</a> GitHub repository and installed by conda inside a virtual environment. Thus you can check there if your particular package is defined, or if the specific version your tool requests is provided. In this example, the R language version 3.2.2 will be installed, as well as the batch and PMCMR R libraries (no version specified, but that could have been possible).</p>
</section>
<section id="command" class="level5">
<h5 class="anchored" data-anchor-id="command"><code>&lt;command&gt;</code></h5>
<p>You must not use anymore the attribute <code>interpreter</code> inside the command tag. The command content will be launched inside a bash session. The programs called must be present inside the <code>PATH</code>, so it must be a standard program (unless you find a way to put your tool program inside the PATH, but we do not recommand that).</p>
<p>Here is an example with a script in R:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">command</span>&gt;<span class="bn">&lt;![CDATA[</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    Rscript $__tool_directory__/mytool-script</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bn">]]&gt;</span>&lt;/<span class="kw">command</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note the use of the <code>$__tool_directory__</code> variable. This is because, according to our experience, <code>planemo test</code> may fail to find your script if the whole is not specified.</p>
</section>
<section id="tests" class="level5">
<h5 class="anchored" data-anchor-id="tests"><code>&lt;tests&gt;</code></h5>
<p>At least one test is required.</p>
<p>The <code>param</code> tags describe the inputs.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">tests</span>&gt;</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">test</span>&gt;</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">param</span><span class="ot"> name=</span><span class="st">"dbfile"</span><span class="ot"> value=</span><span class="st">"filedb.tsv"</span>/&gt;</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">param</span><span class="ot"> name=</span><span class="st">"mzrtinput"</span><span class="ot"> value=</span><span class="st">"mzrt-input-small.tsv"</span>/&gt;</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">param</span><span class="ot"> name=</span><span class="st">"inputfields"</span><span class="ot"> value=</span><span class="st">""</span>/&gt;</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">param</span><span class="ot"> name=</span><span class="st">"mzmode"</span><span class="ot"> value=</span><span class="st">"pos"</span>/&gt;</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">output</span><span class="ot"> name=</span><span class="st">"mainoutput"</span><span class="ot"> file=</span><span class="st">"filedb-small-mz-match-output.tsv"</span>/&gt;</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">output</span><span class="ot"> name=</span><span class="st">"peaksoutput"</span><span class="ot"> file=</span><span class="st">"filedb-small-mz-match-peaks-output.tsv"</span>/&gt;</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">output</span><span class="ot"> name=</span><span class="st">"htmloutput"</span><span class="ot"> file=</span><span class="st">"filedb-small-mz-match-html-output.html"</span>/&gt;</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">test</span>&gt;</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">tests</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The input and output files must be placed in a folder named <code>test-data</code> in the same location as your tool XML file.</p>
<p>More documentation here: <a href="https://wiki.galaxyproject.org/Admin/Tools/WritingTests" class="uri">https://wiki.galaxyproject.org/Admin/Tools/WritingTests</a>.</p>
<p>Be careful, when referencing parameters that are included in a <code>conditional</code> section. You must not use the name of the <code>conditional</code> section as a prefix. For instance, if you have the following <code>conditional</code> section:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">conditional</span><span class="ot"> name=</span><span class="st">"db"</span>&gt;</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">param</span><span class="ot"> name=</span><span class="st">"dbtype"</span><span class="ot"> label=</span><span class="st">"Database"</span><span class="ot"> type=</span><span class="st">"select"</span>&gt;</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">option</span><span class="ot"> value=</span><span class="st">"inhouse"</span>&gt;In-house&lt;/<span class="kw">option</span>&gt;</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">option</span><span class="ot"> value=</span><span class="st">"peakforest"</span>&gt;Peakforest&lt;/<span class="kw">option</span>&gt;</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">param</span>&gt;</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- .... --&gt;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">conditional</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You will use the parameter name <code>dbtype</code> as is, without prefix:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">tests</span>&gt;</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">test</span>&gt;</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">param</span><span class="ot"> name=</span><span class="st">"dbfile"</span><span class="ot"> value=</span><span class="st">"filedb.tsv"</span>/&gt;</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!-- .... --&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">test</span>&gt;</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">tests</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="help" class="level5">
<h5 class="anchored" data-anchor-id="help"><code>&lt;help&gt;</code></h5>
<p>An help section is required.</p>
</section>
<section id="citations" class="level5">
<h5 class="anchored" data-anchor-id="citations"><code>&lt;citations&gt;</code></h5>
<p>This sections is required, as a good practice. In the case you have nothing to put inside this section, and in order to make the <code>planemo lint</code> pass, just write an empty section:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">citations</span>/&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="testing-that-your-tool-xml-file-is-written-correctly" class="level4">
<h4 class="anchored" data-anchor-id="testing-that-your-tool-xml-file-is-written-correctly">Testing that your tool XML file is written correctly</h4>
<p>Running planemo on an XML tool file:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> lint mytool.xml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It will output a list of checks as the following one:</p>
<pre><code>Applying linter tests... CHECK
.. CHECK: 1 test(s) found.
Applying linter stdio... CHECK
.. INFO: No stdio definition found, tool will determine an error from stderr.
Applying linter output... CHECK
.. INFO: 2 outputs found.
Applying linter inputs... CHECK
.. INFO: Found 7 input parameters.
Applying linter help... CHECK
.. CHECK: Tool contains help section.
.. CHECK: Help contains valid reStructuredText.
Applying linter general... CHECK
.. CHECK: Tool defines a version [2.1.1].
.. CHECK: Tool defines a name [Univariate].
.. CHECK: Tool defines an id [Univariate].
Applying linter command... CHECK
.. INFO: Tool contains a command.</code></pre>
</section>
<section id="visualizing-the-tool-in-a-galaxy-instance" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-the-tool-in-a-galaxy-instance">Visualizing the tool in a Galaxy instance</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> serve <span class="at">--install_galaxy</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to launch your tool in this Galaxy instance, you can follow instruction in the <a href="#run-the-tests-on-your-tool">Run the tests on your tool section</a> to install Conda dependencies and use <code>planemo serve</code> with <code>--conda_dependency_resolution</code></p>
</section>
</section>
<section id="testing-a-tool-using-planemo" class="level3">
<h3 class="anchored" data-anchor-id="testing-a-tool-using-planemo">Testing a tool using Planemo</h3>
<section id="run-the-tests-on-your-tool" class="level4">
<h4 class="anchored" data-anchor-id="run-the-tests-on-your-tool">Run the tests on your tool</h4>
<ul>
<li>If not already done, initialize conda:</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> conda_init</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Install your tool requirements:</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> conda_install mytool.xml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Run your tests:</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> test <span class="at">--install_galaxy</span> <span class="at">--galaxy_branch</span> release_16.01 <span class="at">--conda_dependency_resolution</span> mytool.xml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="conda-directory" class="level5">
<h5 class="anchored" data-anchor-id="conda-directory">Conda directory</h5>
<p>Conda installs all its files inside <code>~/miniconda2</code> by default. WARNING: When testing the requirements, it may be that you forget to specify some requirements for your tool, but that your test pass anyway. This is because the requirements were already installed inside <code>~/miniconda2</code>, possibly while testing another tool.</p>
<p>A first solution to avoid this is to erase the <code>~/miniconda2</code> before running <code>planemo conda_install .</code>.</p>
<p>A second solution is to choose a custom folder for conda for your tool through the <code>--conda_prefix</code> option:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> conda_init <span class="at">--conda_prefix</span> /tmp/conda</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> conda_install <span class="at">--conda_prefix</span> /tmp/conda mytool.xml</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> test <span class="at">--install_galaxy</span> <span class="at">--galaxy_branch</span> release_16.01 <span class="at">--conda_prefix</span> /tmp/conda <span class="at">--conda_dependency_resolution</span> mytool.xml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Attention to not choose a too much long prefix, otherwise it could give issue with R Ncurses package, in case your tool depends on it. You would get the error <code>Error: ERROR: placeholder '/Users/aaronmeurer/anaconda/envs/_build_placehold_placehold_placehold_placehold_' too short in: ncurses-5.9-1</code>. This issue will be solved in Conda-Build 2.0.0.</p>
</section>
</section>
</section>
<section id="using-ant-to-run-planemo" class="level3">
<h3 class="anchored" data-anchor-id="using-ant-to-run-planemo">Using Ant to run Planemo</h3>
<p>Here is a <code>build.xml</code> file you can use as a base for running Planemo from Ant:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">project</span><span class="ot"> name=</span><span class="st">"mytool"</span><span class="ot"> default=</span><span class="st">"all"</span>&gt;</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">property</span><span class="ot"> name=</span><span class="st">"tool.xml"</span><span class="ot"> value=</span><span class="st">"mytool.xml"</span>/&gt;</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">property</span><span class="ot"> name=</span><span class="st">"conda.dir"</span><span class="ot"> value=</span><span class="st">"${user.home}/w4m-conda"</span>/&gt;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!--~~~</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ~ ALL ~</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ~~~~~--&gt;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span><span class="ot"> name=</span><span class="st">"all"</span>/&gt;</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!--~~~~</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">    ~ </span><span class="al">TEST</span><span class="co"> ~</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">    ~~~~~--&gt;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span><span class="ot"> name=</span><span class="st">"test"</span><span class="ot"> depends=</span><span class="st">"planemo.lint,planemo.test"</span>/&gt;</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!--~~~~~~~~~~~~</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">    ~ PLANEMO LINT ~</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">    ~~~~~~~~~~~~~--&gt;</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span><span class="ot"> name=</span><span class="st">"planemo.lint"</span>&gt;</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">exec</span><span class="ot"> executable=</span><span class="st">"planemo"</span><span class="ot"> failonerror=</span><span class="st">"true"</span>&gt;</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"lint"</span>/&gt;</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"${tool.xml}"</span>/&gt;</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">exec</span>&gt;</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">target</span>&gt;</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!--~~~~~~~~~~~~</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co">    ~ PLANEMO </span><span class="al">TEST</span><span class="co"> ~</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="co">    ~~~~~~~~~~~~~--&gt;</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span><span class="ot"> name=</span><span class="st">"planemo.test"</span><span class="ot"> depends=</span><span class="st">"planemo.conda.install"</span>&gt;</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">exec</span><span class="ot"> executable=</span><span class="st">"planemo"</span><span class="ot"> failonerror=</span><span class="st">"true"</span>&gt;</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"test"</span>/&gt;</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"--conda_prefix"</span>/&gt;</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"${conda.dir}"</span>/&gt;</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"--galaxy_branch"</span>/&gt;</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"release_16.01"</span>/&gt;</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"--conda_dependency_resolution"</span>/&gt;</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"${tool.xml}"</span>/&gt;</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">exec</span>&gt;</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">target</span>&gt;</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!--~~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a><span class="co">    ~ PLANEMO CONDA INSTALL ~</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a><span class="co">    ~~~~~~~~~~~~~~~~~~~~~~--&gt;</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span><span class="ot"> name=</span><span class="st">"planemo.conda.install"</span><span class="ot"> depends=</span><span class="st">"planemo.conda.init"</span>&gt;</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">exec</span><span class="ot"> executable=</span><span class="st">"planemo"</span><span class="ot"> failonerror=</span><span class="st">"true"</span>&gt;</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"conda_install"</span>/&gt;</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"--conda_prefix"</span>/&gt;</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"${conda.dir}"</span>/&gt;</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"${tool.xml}"</span>/&gt;</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">exec</span>&gt;</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">target</span>&gt;</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!--~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a><span class="co">    ~ PLANEMO CONDA INIT ~</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a><span class="co">    ~~~~~~~~~~~~~~~~~~~--&gt;</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span><span class="ot"> name=</span><span class="st">"planemo.conda.init"</span>&gt;</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">exec</span><span class="ot"> executable=</span><span class="st">"planemo"</span><span class="ot"> failonerror=</span><span class="st">"true"</span>&gt;</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"conda_init"</span>/&gt;</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"--conda_prefix"</span>/&gt;</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span><span class="ot"> value=</span><span class="st">"${conda.dir}"</span>/&gt;</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">exec</span>&gt;</span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">target</span>&gt;</span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">&lt;!--~~~~~</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a><span class="co">    ~ CLEAN ~</span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a><span class="co">    ~~~~~~--&gt;</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">target</span><span class="ot"> name=</span><span class="st">"clean"</span>&gt;</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">delete</span><span class="ot"> dir=</span><span class="st">"${conda.dir}"</span>/&gt;</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">target</span>&gt;</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">project</span>&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="automate-testing-within-github-using-travis" class="level3">
<h3 class="anchored" data-anchor-id="automate-testing-within-github-using-travis">Automate testing within GitHub using Travis</h3>
<p><a href="https://travis-ci.org">Travis CI</a> is a continuous integration service, used in Workflow4Metabolomics. If you are already part of the Workflow4Metabolomics team, you just have to connect into Travis CI using the “Sign with GitHub” button on the <a href="https://travis-ci.org">Travis CI</a> home page. Then you just have to connect the organization account to your Travis account. Follow the instructions on the <a href="https://docs.travis-ci.com/user/getting-started/">Getting started</a> page.</p>
<p>Roughly, the steps are the following ones:</p>
<ol type="1">
<li>Go to your profile page (click on your name at the top right).</li>
<li>Make sure Workflow4Metabolomics is listed in the Organizations listing inside the left column.</li>
<li>Click on <code>Sync account</code> button (at the top right), and wait.</li>
<li>Enable the project you want. This will allow Travis CI to track for changes in branches and run the build.</li>
<li>Define a file <code>.travis.yml</code> at the root of your project repository. This file will tell Travis CI how to build/test your project.</li>
<li>Push the changes in your project repository to GitHub, Travis CI will automatically be triggered and start running the instructions contained inside the file <code>.travis.yml</code>.</li>
</ol>
<section id="without-ant" class="level4">
<h4 class="anchored" data-anchor-id="without-ant">Without Ant</h4>
<p>A minimal <code>.travis.yml</code> that makes use of Planemo can be:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">before_install</span><span class="kw">:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> sudo apt-get install -y python-virtualenv</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> virtualenv planemo-venv</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> . planemo-venv/bin/activate</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> pip install --upgrade pip setuptools</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> pip install planemo</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> planemo conda_init</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">install</span><span class="kw">:</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> planemo conda_install ${TRAVIS_BUILD_DIR}/galaxy/your_tool_directory</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> planemo test --install_galaxy --no_cache_galaxy --conda_dependency_resolution ${TRAVIS_BUILD_DIR}/galaxy/your_tool_directory</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="using-ant" class="level4">
<h4 class="anchored" data-anchor-id="using-ant">Using Ant</h4>
<p>A minimal <code>.travis.yml</code> that makes use of Planemo and Ant can be:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">before_install</span><span class="kw">:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> sudo apt-get install -y python-virtualenv</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> sudo apt-get install -y ant</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> virtualenv planemo-venv</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> . planemo-venv/bin/activate</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> pip install --upgrade pip setuptools</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> pip install planemo</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> planemo conda_init</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="kw">-</span><span class="at"> ant test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="publish-a-tool-in-the-toolshed-using-planemo" class="level3">
<h3 class="anchored" data-anchor-id="publish-a-tool-in-the-toolshed-using-planemo">Publish a tool in the ToolShed using Planemo</h3>
<section id="init-a-tool-publishing" class="level4">
<h4 class="anchored" data-anchor-id="init-a-tool-publishing">Init a tool publishing</h4>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> shed_init <span class="at">--help</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-a-repository-and-upload-files" class="level4">
<h4 class="anchored" data-anchor-id="create-a-repository-and-upload-files">Create a repository and upload files</h4>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> shed_create <span class="at">--help</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="updating-an-existing-tool" class="level4">
<h4 class="anchored" data-anchor-id="updating-an-existing-tool">Updating an existing tool</h4>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">planemo</span> shed_update <span class="at">--help</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jsaintvanne\.github\.io\/workflow4metabolomics\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Julien Saint-Vanne</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with ❤️</p>
</div>
  </div>
</footer>




</body></html>